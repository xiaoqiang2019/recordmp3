/*
录音
https://github.com/xiangyuecn/Recorder
src: extensions/dtmf.decode.js
*/
!function(){"use strict";Recorder.DTMF_Decode=function(t,r,a){a||(a={});var e=a.lastIs||"",o=null==a.lastCheckCount?99:a.lastCheckCount,l=a.totalLen||0,n=a.pcm,h=[];if(!Recorder.LibFFT)throw new Error("需要lib.fft.js支持");var s=256,u=Recorder.LibFFT(s),g=l,c=r/4e3,M=Math.floor(t.length/c);l+=M;var f=0;n&&n.length>s&&(M+=f=256,g-=f);var v=new Int16Array(M);f&&v.set(n.subarray(n.length-f));for(var d=0;d<t.length;f++,d+=c)v[f]=t[Math.round(d)];t=v;for(var i=(r=4e3)/s,k=1<<(Math.round(Math.log(s)/Math.log(2)+3)<<1),y=Math.log(k)/Math.log(10),C=Math.log(16383.5)+y,b=0;b+s<=t.length;b+=64){v=t.subarray(b,b+s);for(var F=u.transform(v),m=0,L=0,p=0,w=0,D=0;D<F.length;D++){var I=F[D],R=(D+1)*i;L<I&&R<1050?Math.log(I)>C&&(L=I,w=R):m<I&&1050<R&&Math.log(I)>C&&(m=I,p=R)}var T=_(w,B[0],i),A=_(p,B[1],i),j="";0<=T&&0<=A?(j=E[T][A],e?e.key==j?o++:(j="",o=e.old+o):3<=o?(e={key:j,old:o,start:b,use:0},o=1):(j="",o=0)):e&&(o=e.old+o),j?(3<=o&&!e.use&&(e.use=1,h.push({key:j,time:Math.round((g+e.start)/r*1e3)})),e.use&&(o=e.old=0)):(e="",o++)}return{keys:h,lastIs:e,lastCheckCount:o,totalLen:l,pcm:t}};var B=[[697,770,852,941],[1209,1336,1477,1633]],E=[["1","2","3","A"],["4","5","6","B"],["7","8","9","C"],["*","0","#","D"]],_=function(t,r,a){for(var e=-1,o=1e3,l=0;l<r.length;l++){var n=Math.abs(r[l]-t);n<o&&(o=n)<a&&(e=l)}return e}}();